{"version":3,"sources":["main.js"],"names":["console","clear","blockData","selector","name","pitch","soundSetData","sets","levelDatas","Blocks","blockAssign","setAssign","allOn","blocks","map","d","i","el","$","audio","getAudioObject","soundSets","prototype","flash","note","block","find","currentTime","play","addClass","setTimeout","removeClass","turnAllOn","forEach","turnAllOff","Audio","playSet","type","set","obj","Game","levels","currentLevel","playInterval","mode","loadLevels","_this","ajax","url","success","res","startLevel","showMessage","levelData","startGame","mes","log","text","answer","notes","split","showStatus","timer","setInterval","char","shift","playNote","length","startUserInput","clearInterval","userInput","userSendInput","inputChar","tempString","indexOf","html","circle","append","game"],"mappings":"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","file":"main.js","sourcesContent":["console.clear()\r\n// ----------\r\n// 方塊物件\r\n// ----------\r\nvar blockData = [\r\n  {selector: \".block1\", name: \"1\", pitch: \"1\"},\r\n  {selector: \".block2\", name: \"2\", pitch: \"2\"},\r\n  {selector: \".block3\", name: \"3\", pitch: \"3\"},\r\n  {selector: \".block4\", name: \"4\", pitch: \"4\"},\r\n]\r\nvar soundSetData = [\r\n  {name: \"correct\", sets: [1,3,5,8]},\r\n  {name: \"wrong\", sets: [2,4,5.5,7]},  \r\n]\r\nvar levelDatas = [\r\n  \"123\",\r\n  \"1234\",\r\n  \"12324\",\r\n  \"321242\",\r\n  \"2341231\",\r\n  \"31241321\"\r\n]\r\n// var resultSets = soundSetData[0].sets.map(function(pitch){\r\n//   return this.getAudioObject(pitch)\r\n// })\r\n// 方塊資料 遊戲特效\r\nvar Blocks = function(blockAssign, setAssign){\r\n  // 全點亮\r\n  this.allOn = false\r\n  // data=d, index=i, 抓$(selector)物件\r\n  this.blocks = blockAssign.map((d,i)=>{\r\n    return{\r\n      name: d.name,\r\n      el: $(d.selector),\r\n      audio: this.getAudioObject(d.pitch)\r\n    }\r\n  })\r\n  this.soundSets = setAssign.map((d,i)=>{\r\n    return{\r\n      name: d.name,\r\n      sets: d.sets.map((pitch)=>{\r\n        return this.getAudioObject(pitch)\r\n      })\r\n    }\r\n  })\r\n}\r\n// 閃爍單一方塊＋聲音(方塊名)\r\nBlocks.prototype.flash = function(note){\r\n  let block = this.blocks.find(d=>d.name==note)\r\n  if(block){\r\n    block.audio.currentTime = 0\r\n    block.audio.play()\r\n    block.el.addClass(\"active\")\r\n    setTimeout(()=>{\r\n      if(this.allOn==false){\r\n        block.el.removeClass(\"active\")\r\n      }\r\n    },100)\r\n  }\r\n}\r\n// 開啟所有方塊\r\nBlocks.prototype.turnAllOn = function(){\r\n  this.allOn = true\r\n  this.blocks.forEach((block)=>{\r\n    block.el.addClass(\"active\")\r\n  })\r\n}\r\n// 關掉所有方塊\r\nBlocks.prototype.turnAllOff = function(){\r\n  this.allOn = false\r\n  this.blocks.forEach((block)=>{\r\n    block.el.removeClass(\"active\")\r\n  })\r\n}\r\n// 取得聲音物件\r\nBlocks.prototype.getAudioObject = function(pitch){\r\n  return new Audio(\"https://awiclass.monoame.com/pianosound/set/\"+pitch+\".wav\")\r\n}\r\n// 播放序列聲音（成功/失敗...）\r\nBlocks.prototype.playSet = function(type){\r\n  // 聲音的名字\r\n  let sets = this.soundSets.find(set=>set.name==type).sets\r\n  sets.forEach((obj)=>{\r\n    obj.currentTime = 0\r\n    obj.play()\r\n  })\r\n}\r\n// var blocks = new Blocks(blockData, soundSetData)\r\n\r\n// ----------\r\n// 遊戲物件\r\n// ----------\r\nvar Game = function(){\r\n  this.blocks = new Blocks(blockData, soundSetData)\r\n  this.levels = levelDatas\r\n  // 關卡從0開始\r\n  this.currentLevel = 0\r\n  // 播放間隔\r\n  this.playInterval = 400\r\n  // 關卡狀態\r\n  this.mode = \"waiting\"\r\n}\r\n\r\n// Ajax\r\n// 不要偷看答案\r\nGame.prototype.loadLevels = function(){\r\n  let _this = this\r\n  $.ajax({\r\n    url: \"https://2017.awiclass.monoame.com/api/demo/memorygame/leveldata\",\r\n    success: function(res){\r\n      _this.levels = res\r\n    }\r\n  })\r\n}\r\n         \r\nGame.prototype.startLevel = function(){\r\n  this.showMessage(\"Level \" + this.currentLevel)\r\n  let levelData = this.levels[this.currentLevel]\r\n  this.startGame(levelData)\r\n}\r\nGame.prototype.showMessage = function(mes){\r\n  console.log(mes)\r\n  $(\".status\").text(mes)\r\n}\r\n// 開始出題\r\nGame.prototype.startGame = function(answer){\r\n  this.mode = \"gamePlay\"\r\n  // 存取答案\r\n  this.answer = answer\r\n  // 一個個音符播放\r\n  let notes = this.answer.split(\"\")\r\n  this.showStatus(\"\")\r\n  // 如果沒有長度會把計時器關掉，要把計時器存起來\r\n  this.timer = setInterval(()=>{\r\n    // char=取出來的數字\r\n    let char = notes.shift()\r\n    // console.log(char)\r\n    this.playNote(char)\r\n    // !notes.length 意思一樣\r\n    if(notes.length==0){\r\n      // console.log(\"audio play end\")\r\n      this.startUserInput()\r\n      clearInterval(this.timer)\r\n    }\r\n  },this.playInterval)\r\n}\r\nGame.prototype.playNote = function(note){\r\n  console.log(note)\r\n  this.blocks.flash(note)\r\n}\r\n\r\n// 開始輸入模式\r\nGame.prototype.startUserInput = function(){\r\n  // 暫存使用者輸入的變數\r\n  this.userInput = \"\"\r\n  // 切換給使用者\r\n  this.mode = \"userInput\"\r\n}\r\n// 比對使用者輸入答案\r\nGame.prototype.userSendInput = function(inputChar){\r\n  // 現在是不是使用者輸入模式\r\n  if(this.mode==\"userInput\"){\r\n    // 使用者輸入的集合\r\n    let tempString = this.userInput + inputChar\r\n    this.playNote(inputChar)\r\n    this.showStatus(tempString)\r\n    if(this.answer.indexOf(tempString)==0){\r\n      console.log(\"good\")\r\n      if(this.answer==tempString){\r\n        this.showMessage(\"Correct\")\r\n        this.currentLevel+=1\r\n        this.mode = \"waiting\"\r\n        setTimeout(()=>{\r\n          this.startLevel()\r\n        },1000)\r\n        // console.log(\"correct\")\r\n      }\r\n    } else{\r\n        this.showMessage(\"Wrong\")\r\n        this.currentLevel=0\r\n        this.mode = \"waiting\"\r\n        setTimeout(()=>{\r\n          this.startLevel()\r\n        },1000)\r\n        // console.log(\"wrong\")\r\n        // this.startGame(\"1234\")\r\n    }\r\n    console.log(tempString)\r\n    this.userInput+=inputChar\r\n  }\r\n}\r\nGame.prototype.showStatus = function(tempString){\r\n  $(\".inputStatus\").html(\"\")\r\n  this.answer.split(\"\").forEach((d,i)=>{\r\n    var circle = $(\"<div class='circle'></div>\")\r\n    if(i<tempString.length){\r\n      circle.addClass(\"correct\")\r\n    }\r\n    $(\".inputStatus\").append(circle)\r\n  })\r\n  if(tempString==\"\"){\r\n    this.blocks.turnAllOff()\r\n  }\r\n  if(tempString==this.answer){\r\n    $(\".inputStatus\").addClass(\"correct\")\r\n    setTimeout(()=>{\r\n      this.blocks.turnAllOn()\r\n      this.blocks.playSet(\"correct\")\r\n    },500)\r\n  }else{\r\n    $(\".inputStatus\").removeClass(\"correct\")\r\n  }\r\n  if(this.answer.indexOf(tempString)!=0){\r\n    $(\".inputStatus\").addClass(\"wrong\")\r\n    setTimeout(()=>{\r\n      this.blocks.turnAllOn()\r\n      this.blocks.playSet(\"wrong\")\r\n    },500)\r\n  }else{\r\n    $(\".inputStatus\").removeClass(\"wrong\")\r\n  }\r\n}\r\nvar game = new Game()\r\n// game.startGame(\"1234\")\r\n\r\n// 用遠端資料\r\ngame.loadLevels()\r\n\r\n// 開始遊戲\r\nsetTimeout(()=>{\r\n  game.startLevel()\r\n},1000)\r\n"]}